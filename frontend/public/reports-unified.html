<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InfoSentinel - Security Reports</title>
    <link rel="stylesheet" href="css/cyberpunk-unified.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>
    <!-- Unified Navigation -->
    <nav class="cyber-nav">
        <a href="index-unified.html" class="nav-brand">
            <div class="nav-logo">IS</div>
            <div class="nav-title">InfoSentinel</div>
        </a>
        
        <ul class="nav-links" id="navLinks">
            <li><a href="index-unified.html" class="nav-link">Dashboard</a></li>
            <li><a href="pentest-unified.html" class="nav-link">Penetration Testing</a></li>
            <li><a href="vulnerabilities-unified.html" class="nav-link">Vulnerabilities</a></li>
            <li><a href="reports-unified.html" class="nav-link active">Reports</a></li>
            <li><a href="stats-unified.html" class="nav-link">Statistics</a></li>
            <li><a href="login-unified.html" class="nav-link">Login</a></li>
        </ul>
        
        <button class="nav-toggle" id="navToggle">‚ò∞</button>
    </nav>

    <!-- Main Content -->
    <main class="cyber-main">
        <div class="cyber-container">
            <!-- Header -->
            <section class="cyber-section animate-fade-in-up">
                <div class="text-center mb-4">
                    <h1 class="cyber-section-title">üìä Security Reports</h1>
                    <p class="cyber-section-subtitle">Professional security assessment reports and documentation</p>
                </div>
            </section>

            <!-- Report Generation -->
            <section class="cyber-section">
                <div class="cyber-grid cyber-grid-2">
                    <!-- Report Configuration -->
                    <div class="cyber-card">
                        <div class="cyber-card-header">
                            <h3 class="cyber-card-title">‚öôÔ∏è Report Configuration</h3>
                            <p class="cyber-card-subtitle">Customize your security report parameters</p>
                        </div>
                        
                        <form id="reportForm">
                            <div class="mb-3">
                                <label class="block text-primary mb-2">Report Type</label>
                                <select class="cyber-select" id="reportType" onchange="updateReportOptions()">
                                    <option value="executive">Executive Summary</option>
                                    <option value="technical">Technical Assessment</option>
                                    <option value="compliance">Compliance Report</option>
                                    <option value="vulnerability">Vulnerability Report</option>
                                    <option value="penetration">Penetration Test Report</option>
                                    <option value="custom">Custom Report</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label class="block text-primary mb-2">Report Title</label>
                                <input type="text" class="cyber-input" id="reportTitle" 
                                       value="Security Assessment Report" placeholder="Enter report title">
                            </div>
                            
                            <div class="mb-3">
                                <label class="block text-primary mb-2">Organization</label>
                                <input type="text" class="cyber-input" id="organization" 
                                       value="InfoSentinel Security" placeholder="Organization name">
                            </div>
                            
                            <div class="cyber-grid cyber-grid-2 mb-3">
                                <div>
                                    <label class="block text-primary mb-2">Date Range From</label>
                                    <input type="date" class="cyber-input" id="dateFrom">
                                </div>
                                <div>
                                    <label class="block text-primary mb-2">Date Range To</label>
                                    <input type="date" class="cyber-input" id="dateTo">
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="block text-primary mb-2">Include Sections</label>
                                <div class="report-sections">
                                    <label class="flex items-center gap-2 mb-2">
                                        <input type="checkbox" checked id="includeExecutiveSummary"> Executive Summary
                                    </label>
                                    <label class="flex items-center gap-2 mb-2">
                                        <input type="checkbox" checked id="includeVulnerabilities"> Vulnerability Analysis
                                    </label>
                                    <label class="flex items-center gap-2 mb-2">
                                        <input type="checkbox" checked id="includeRiskAssessment"> Risk Assessment
                                    </label>
                                    <label class="flex items-center gap-2 mb-2">
                                        <input type="checkbox" id="includeCompliance"> Compliance Status
                                    </label>
                                    <label class="flex items-center gap-2 mb-2">
                                        <input type="checkbox" id="includeRecommendations"> Recommendations
                                    </label>
                                    <label class="flex items-center gap-2 mb-2">
                                        <input type="checkbox" id="includeAppendix"> Technical Appendix
                                    </label>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="block text-primary mb-2">Output Format</label>
                                <select class="cyber-select" id="outputFormat">
                                    <option value="pdf">PDF Document</option>
                                    <option value="html">HTML Report</option>
                                    <option value="json">JSON Data</option>
                                    <option value="csv">CSV Export</option>
                                </select>
                            </div>
                            
                            <div class="flex gap-2">
                                <button type="button" class="cyber-btn cyber-btn-primary" onclick="generateReport()">
                                    üìÑ Generate Report
                                </button>
                                <button type="button" class="cyber-btn cyber-btn-secondary" onclick="previewReport()">
                                    üëÅÔ∏è Preview
                                </button>
                                <button type="button" class="cyber-btn cyber-btn-secondary" onclick="saveTemplate()">
                                    üíæ Save Template
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Report Status -->
                    <div class="cyber-card">
                        <div class="cyber-card-header">
                            <h3 class="cyber-card-title">üìà Report Status</h3>
                            <p class="cyber-card-subtitle">Generation progress and report queue</p>
                        </div>
                        
                        <div id="reportStatus">
                            <div class="report-progress mb-3">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-primary">Status:</span>
                                    <span class="cyber-badge cyber-badge-info" id="reportStatusBadge">Ready</span>
                                </div>
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-primary">Progress:</span>
                                    <span id="reportProgress">0%</span>
                                </div>
                                <div class="cyber-progress mb-3">
                                    <div class="cyber-progress-bar" id="reportProgressBar" style="width: 0%"></div>
                                </div>
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-primary">Current Step:</span>
                                    <span id="currentStep">Waiting...</span>
                                </div>
                            </div>
                            
                            <div class="report-queue">
                                <h4 class="text-primary mb-2">Recent Reports</h4>
                                <div id="reportQueue">
                                    <!-- Dynamic content -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Report Templates -->
            <section class="cyber-section">
                <div class="cyber-card">
                    <div class="cyber-card-header">
                        <h3 class="cyber-card-title">üìã Report Templates</h3>
                        <p class="cyber-card-subtitle">Pre-configured report templates for common use cases</p>
                    </div>
                    
                    <div class="cyber-grid cyber-grid-3">
                        <div class="template-card cyber-card" onclick="loadTemplate('executive')">
                            <div class="template-icon mb-2">üëî</div>
                            <h4 class="text-primary mb-2">Executive Summary</h4>
                            <p class="text-secondary text-sm mb-3">High-level security overview for management and stakeholders</p>
                            <div class="template-features">
                                <span class="cyber-badge cyber-badge-info">Risk Overview</span>
                                <span class="cyber-badge cyber-badge-info">Key Metrics</span>
                            </div>
                        </div>
                        
                        <div class="template-card cyber-card" onclick="loadTemplate('technical')">
                            <div class="template-icon mb-2">üîß</div>
                            <h4 class="text-primary mb-2">Technical Assessment</h4>
                            <p class="text-secondary text-sm mb-3">Detailed technical findings and vulnerability analysis</p>
                            <div class="template-features">
                                <span class="cyber-badge cyber-badge-info">Detailed Findings</span>
                                <span class="cyber-badge cyber-badge-info">Technical Data</span>
                            </div>
                        </div>
                        
                        <div class="template-card cyber-card" onclick="loadTemplate('compliance')">
                            <div class="template-icon mb-2">üìú</div>
                            <h4 class="text-primary mb-2">Compliance Report</h4>
                            <p class="text-secondary text-sm mb-3">Regulatory compliance status and audit findings</p>
                            <div class="template-features">
                                <span class="cyber-badge cyber-badge-info">OWASP Top 10</span>
                                <span class="cyber-badge cyber-badge-info">PCI DSS</span>
                            </div>
                        </div>
                        
                        <div class="template-card cyber-card" onclick="loadTemplate('vulnerability')">
                            <div class="template-icon mb-2">üö®</div>
                            <h4 class="text-primary mb-2">Vulnerability Report</h4>
                            <p class="text-secondary text-sm mb-3">Comprehensive vulnerability assessment and remediation guide</p>
                            <div class="template-features">
                                <span class="cyber-badge cyber-badge-info">CVSS Scoring</span>
                                <span class="cyber-badge cyber-badge-info">Remediation</span>
                            </div>
                        </div>
                        
                        <div class="template-card cyber-card" onclick="loadTemplate('penetration')">
                            <div class="template-icon mb-2">üéØ</div>
                            <h4 class="text-primary mb-2">Penetration Test</h4>
                            <p class="text-secondary text-sm mb-3">Detailed penetration testing methodology and results</p>
                            <div class="template-features">
                                <span class="cyber-badge cyber-badge-info">Attack Vectors</span>
                                <span class="cyber-badge cyber-badge-info">Exploitation</span>
                            </div>
                        </div>
                        
                        <div class="template-card cyber-card" onclick="loadTemplate('custom')">
                            <div class="template-icon mb-2">‚öôÔ∏è</div>
                            <h4 class="text-primary mb-2">Custom Report</h4>
                            <p class="text-secondary text-sm mb-3">Build your own report with custom sections and data</p>
                            <div class="template-features">
                                <span class="cyber-badge cyber-badge-info">Flexible</span>
                                <span class="cyber-badge cyber-badge-info">Customizable</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Report Preview -->
            <section class="cyber-section" id="reportPreviewSection" style="display: none;">
                <div class="cyber-card">
                    <div class="cyber-card-header">
                        <h3 class="cyber-card-title">üëÅÔ∏è Report Preview</h3>
                        <p class="cyber-card-subtitle">Preview of your generated security report</p>
                    </div>
                    
                    <div id="reportPreview" class="report-preview">
                        <!-- Dynamic report content -->
                    </div>
                    
                    <div class="flex gap-2 mt-3">
                        <button class="cyber-btn cyber-btn-primary" onclick="downloadReport()">
                            üì• Download PDF
                        </button>
                        <button class="cyber-btn cyber-btn-secondary" onclick="emailReport()">
                            üìß Email Report
                        </button>
                        <button class="cyber-btn cyber-btn-secondary" onclick="shareReport()">
                            üîó Share Link
                        </button>
                        <button class="cyber-btn cyber-btn-secondary" onclick="editReport()">
                            ‚úèÔ∏è Edit Report
                        </button>
                    </div>
                </div>
            </section>

            <!-- Scheduled Reports -->
            <section class="cyber-section">
                <div class="cyber-card">
                    <div class="cyber-card-header">
                        <h3 class="cyber-card-title">‚è∞ Scheduled Reports</h3>
                        <p class="cyber-card-subtitle">Automated report generation and delivery</p>
                    </div>
                    
                    <div class="cyber-grid cyber-grid-2">
                        <div>
                            <h4 class="text-primary mb-3">Create Schedule</h4>
                            <form id="scheduleForm">
                                <div class="mb-3">
                                    <label class="block text-primary mb-2">Report Template</label>
                                    <select class="cyber-select" id="scheduleTemplate">
                                        <option value="executive">Executive Summary</option>
                                        <option value="technical">Technical Assessment</option>
                                        <option value="compliance">Compliance Report</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="block text-primary mb-2">Frequency</label>
                                    <select class="cyber-select" id="scheduleFrequency">
                                        <option value="daily">Daily</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="monthly">Monthly</option>
                                        <option value="quarterly">Quarterly</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="block text-primary mb-2">Recipients</label>
                                    <input type="email" class="cyber-input" id="scheduleRecipients" 
                                           placeholder="email1@example.com, email2@example.com">
                                </div>
                                
                                <button type="button" class="cyber-btn cyber-btn-primary" onclick="createSchedule()">
                                    ‚ûï Create Schedule
                                </button>
                            </form>
                        </div>
                        
                        <div>
                            <h4 class="text-primary mb-3">Active Schedules</h4>
                            <div id="activeSchedules">
                                <!-- Dynamic content -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Report Preview Styles -->
    <style>
        .template-card {
            cursor: pointer;
            transition: var(--transition-smooth);
            text-align: center;
            padding: 1.5rem;
        }
        
        .template-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-cyan);
        }
        
        .template-icon {
            font-size: 2rem;
            text-align: center;
        }
        
        .template-features {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .report-preview {
            background: white;
            color: #000;
            padding: 2rem;
            border-radius: var(--radius-md);
            max-height: 600px;
            overflow-y: auto;
            font-family: 'Times New Roman', serif;
        }
        
        .report-preview h1 {
            color: #2563eb;
            border-bottom: 2px solid #2563eb;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .report-preview h2 {
            color: #1e40af;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }
        
        .report-preview h3 {
            color: #1e3a8a;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
        }
        
        .report-preview table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        
        .report-preview th,
        .report-preview td {
            border: 1px solid #ddd;
            padding: 0.5rem;
            text-align: left;
        }
        
        .report-preview th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        
        .schedule-item {
            background: var(--bg-glass-light);
            border-radius: var(--radius-sm);
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 3px solid var(--accent-cyan);
        }
    </style>

    <!-- JavaScript -->
    <script>
        // Navigation Toggle
        document.getElementById('navToggle').addEventListener('click', function() {
            const navLinks = document.getElementById('navLinks');
            navLinks.classList.toggle('active');
        });

        // Report generation state
        let reportGenerating = false;
        let currentReportData = null;
        let reportQueue = [];
        let activeSchedules = [];

        // Initialize dates
        function initializeDates() {
            const today = new Date();
            const lastWeek = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            
            document.getElementById('dateFrom').value = lastWeek.toISOString().split('T')[0];
            document.getElementById('dateTo').value = today.toISOString().split('T')[0];
        }

        // Update report options based on type
        function updateReportOptions() {
            const reportType = document.getElementById('reportType').value;
            const sections = {
                'executive': {
                    title: 'Executive Security Summary',
                    sections: ['includeExecutiveSummary', 'includeRiskAssessment']
                },
                'technical': {
                    title: 'Technical Security Assessment',
                    sections: ['includeVulnerabilities', 'includeRiskAssessment', 'includeRecommendations', 'includeAppendix']
                },
                'compliance': {
                    title: 'Security Compliance Report',
                    sections: ['includeCompliance', 'includeVulnerabilities', 'includeRecommendations']
                },
                'vulnerability': {
                    title: 'Vulnerability Assessment Report',
                    sections: ['includeVulnerabilities', 'includeRiskAssessment', 'includeRecommendations']
                },
                'penetration': {
                    title: 'Penetration Testing Report',
                    sections: ['includeExecutiveSummary', 'includeVulnerabilities', 'includeRecommendations', 'includeAppendix']
                }
            };
            
            if (sections[reportType]) {
                document.getElementById('reportTitle').value = sections[reportType].title;
                
                // Reset all checkboxes
                document.querySelectorAll('.report-sections input[type="checkbox"]').forEach(cb => {
                    cb.checked = false;
                });
                
                // Check relevant sections
                sections[reportType].sections.forEach(sectionId => {
                    const checkbox = document.getElementById(sectionId);
                    if (checkbox) checkbox.checked = true;
                });
            }
        }

        // Load template
        function loadTemplate(templateType) {
            document.getElementById('reportType').value = templateType;
            updateReportOptions();
        }

        // Generate report using AI endpoint
        async function generateReport() {
            if (reportGenerating) return;
            
            reportGenerating = true;
            document.getElementById('reportStatusBadge').textContent = 'Generating';
            document.getElementById('reportStatusBadge').className = 'cyber-badge cyber-badge-warning';
            
            const steps = [
                'Connecting to AI analysis engine...',
                'Processing scan data...',
                'Analyzing vulnerabilities...',
                'Calculating risk scores...',
                'Generating executive summary...',
                'Compiling recommendations...',
                'Finalizing report...'
            ];
            
            let currentStepIndex = 0;
            let progress = 0;
            
            const progressInterval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 100) progress = 100;
                
                document.getElementById('reportProgress').textContent = Math.floor(progress) + '%';
                document.getElementById('reportProgressBar').style.width = progress + '%';
                
                if (currentStepIndex < steps.length) {
                    document.getElementById('currentStep').textContent = steps[currentStepIndex];
                    currentStepIndex++;
                }
                
                if (progress >= 100) {
                    clearInterval(progressInterval);
                }
            }, 800);
            
            try {
                const reportType = document.getElementById('reportType').value;
                const reportTitle = document.getElementById('reportTitle').value;
                const organization = document.getElementById('organization').value;
                
                // Use scan ID 1 as default for now - could be made configurable
                const scanId = '1';
                
                const response = await fetch('http://localhost:5001/api/ai/report', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ scan_id: scanId })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to generate report');
                }
                
                const aiReport = await response.json();
                completeAIReportGeneration(aiReport);
                
            } catch (error) {
                console.error('Error generating AI report:', error);
                document.getElementById('reportStatusBadge').textContent = 'Error';
                document.getElementById('reportStatusBadge').className = 'cyber-badge cyber-badge-danger';
                document.getElementById('currentStep').textContent = 'Failed to generate report';
                reportGenerating = false;
            }
        }

        // Complete AI report generation
        function completeAIReportGeneration(aiReport) {
            reportGenerating = false;
            document.getElementById('reportStatusBadge').textContent = 'Completed';
            document.getElementById('reportStatusBadge').className = 'cyber-badge cyber-badge-success';
            document.getElementById('currentStep').textContent = 'Report ready for download';
            
            // Add to report queue
            const reportData = {
                id: 'RPT-' + Date.now(),
                title: document.getElementById('reportTitle').value,
                type: document.getElementById('reportType').value,
                format: document.getElementById('outputFormat').value,
                generated: new Date().toLocaleString(),
                size: (Math.random() * 5 + 1).toFixed(1) + ' MB',
                aiData: aiReport
            };
            
            reportQueue.unshift(reportData);
            currentReportData = reportData;
            updateReportQueue();
            
            // Show preview with AI data
            previewAIReport(aiReport);
        }
        
        // Preview AI report
        function previewAIReport(aiReport) {
            const reportTitle = document.getElementById('reportTitle').value;
            const organization = document.getElementById('organization').value;
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            
            const previewContent = generateAIReportHTML(aiReport, reportTitle, organization, dateFrom, dateTo);
            
            document.getElementById('reportPreview').innerHTML = previewContent;
            document.getElementById('reportPreviewSection').style.display = 'block';
            
            // Scroll to preview
            document.getElementById('reportPreviewSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Generate AI report HTML
         function generateAIReportHTML(aiReport, title, org, dateFrom, dateTo) {
              if (!aiReport) {
                  return generateReportHTML(document.getElementById('reportType').value, title, org, dateFrom, dateTo);
              }
              
              let content = `
                  <h1>${title}</h1>
                  <p><strong>Organization:</strong> ${org}</p>
                  <p><strong>Assessment Period:</strong> ${dateFrom} to ${dateTo}</p>
                  <p><strong>Report Generated:</strong> ${new Date().toLocaleDateString()}</p>
                  <hr>
              `;
              
              // Add AI-generated content
              if (aiReport.exec_summary) {
                  content += `<h2>Executive Summary</h2><p>${aiReport.exec_summary}</p>`;
              }
              
              if (aiReport.findings && aiReport.findings.length > 0) {
                  content += '<h2>Detailed Findings</h2>';
                  aiReport.findings.forEach(finding => {
                      content += `
                          <h3>${finding.name}</h3>
                          <p><strong>Description:</strong> ${finding.description}</p>
                          <p><strong>Severity:</strong> ${finding.severity} (CVSS: ${finding.cvss_score})</p>
                          <p><strong>Location:</strong> ${finding.location}</p>
                          <p><strong>Remediation:</strong> ${finding.remediation}</p>
                          <p><strong>References:</strong> ${finding.references ? finding.references.join(', ') : 'N/A'}</p>
                          <hr>
                      `;
                  });
              }
              
              if (aiReport.recommendations && aiReport.recommendations.length > 0) {
                  content += '<h2>Recommendations</h2><ol>';
                  aiReport.recommendations.forEach(rec => {
                      content += `<li>${rec}</li>`;
                  });
                  content += '</ol>';
              }
              
              if (aiReport.severity_counts) {
                  content += '<h2>Risk Assessment</h2>';
                  content += '<table border="1" style="border-collapse: collapse; width: 100%;">';
                  content += '<tr><th>Severity</th><th>Count</th></tr>';
                  Object.entries(aiReport.severity_counts).forEach(([severity, count]) => {
                      content += `<tr><td>${severity}</td><td>${count}</td></tr>`;
                  });
                  content += '</table>';
              }
              
              return content;
          }

        // Preview report
        function previewReport() {
            const reportType = document.getElementById('reportType').value;
            const reportTitle = document.getElementById('reportTitle').value;
            const organization = document.getElementById('organization').value;
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            
            const previewContent = generateReportHTML(reportType, reportTitle, organization, dateFrom, dateTo);
            
            document.getElementById('reportPreview').innerHTML = previewContent;
            document.getElementById('reportPreviewSection').style.display = 'block';
            
            // Scroll to preview
            document.getElementById('reportPreviewSection').scrollIntoView({ behavior: 'smooth' });
        }

        // Generate report HTML
        function generateReportHTML(type, title, org, dateFrom, dateTo) {
            const executiveSummary = `
                <h2>Executive Summary</h2>
                <p>This security assessment was conducted for ${org} from ${dateFrom} to ${dateTo}. The assessment identified several security vulnerabilities and provides recommendations for remediation.</p>
                
                <h3>Key Findings</h3>
                <ul>
                    <li>12 Critical vulnerabilities requiring immediate attention</li>
                    <li>28 High-severity vulnerabilities identified</li>
                    <li>Overall security posture: Moderate Risk</li>
                    <li>Compliance status: 78% compliant with industry standards</li>
                </ul>
            `;
            
            const vulnerabilityAnalysis = `
                <h2>Vulnerability Analysis</h2>
                <p>The following table summarizes the vulnerabilities identified during the assessment:</p>
                
                <table>
                    <thead>
                        <tr>
                            <th>Severity</th>
                            <th>Count</th>
                            <th>Percentage</th>
                            <th>CVSS Range</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Critical</td>
                            <td>12</td>
                            <td>15%</td>
                            <td>9.0 - 10.0</td>
                        </tr>
                        <tr>
                            <td>High</td>
                            <td>28</td>
                            <td>35%</td>
                            <td>7.0 - 8.9</td>
                        </tr>
                        <tr>
                            <td>Medium</td>
                            <td>32</td>
                            <td>40%</td>
                            <td>4.0 - 6.9</td>
                        </tr>
                        <tr>
                            <td>Low</td>
                            <td>8</td>
                            <td>10%</td>
                            <td>0.1 - 3.9</td>
                        </tr>
                    </tbody>
                </table>
                
                <h3>Top Critical Vulnerabilities</h3>
                <ol>
                    <li><strong>SQL Injection in Login Form</strong> - CVSS 9.8</li>
                    <li><strong>Remote Code Execution in File Upload</strong> - CVSS 9.5</li>
                    <li><strong>Authentication Bypass</strong> - CVSS 9.2</li>
                </ol>
            `;
            
            const riskAssessment = `
                <h2>Risk Assessment</h2>
                <p>Based on the identified vulnerabilities and their potential impact, the overall risk level is assessed as <strong>HIGH</strong>.</p>
                
                <h3>Risk Factors</h3>
                <ul>
                    <li>Critical vulnerabilities in public-facing applications</li>
                    <li>Insufficient input validation and sanitization</li>
                    <li>Weak authentication mechanisms</li>
                    <li>Outdated software components with known vulnerabilities</li>
                </ul>
                
                <h3>Business Impact</h3>
                <p>The identified vulnerabilities could lead to:</p>
                <ul>
                    <li>Data breaches and unauthorized access to sensitive information</li>
                    <li>Service disruption and downtime</li>
                    <li>Regulatory compliance violations</li>
                    <li>Reputational damage and financial losses</li>
                </ul>
            `;
            
            const recommendations = `
                <h2>Recommendations</h2>
                <h3>Immediate Actions (0-30 days)</h3>
                <ol>
                    <li>Patch all critical vulnerabilities identified in this report</li>
                    <li>Implement input validation for all user inputs</li>
                    <li>Enable multi-factor authentication for all administrative accounts</li>
                    <li>Update all software components to the latest versions</li>
                </ol>
                
                <h3>Short-term Actions (1-3 months)</h3>
                <ol>
                    <li>Implement a comprehensive vulnerability management program</li>
                    <li>Conduct regular security awareness training for employees</li>
                    <li>Deploy intrusion detection and prevention systems</li>
                    <li>Establish incident response procedures</li>
                </ol>
                
                <h3>Long-term Actions (3-12 months)</h3>
                <ol>
                    <li>Implement a security-by-design approach for new applications</li>
                    <li>Establish continuous security monitoring</li>
                    <li>Conduct regular penetration testing</li>
                    <li>Achieve compliance with relevant security frameworks</li>
                </ol>
            `;
            
            let content = `
                <h1>${title}</h1>
                <p><strong>Organization:</strong> ${org}</p>
                <p><strong>Assessment Period:</strong> ${dateFrom} to ${dateTo}</p>
                <p><strong>Report Generated:</strong> ${new Date().toLocaleDateString()}</p>
                <hr>
            `;
            
            // Add sections based on checkboxes
            if (document.getElementById('includeExecutiveSummary').checked) {
                content += executiveSummary;
            }
            
            if (document.getElementById('includeVulnerabilities').checked) {
                content += vulnerabilityAnalysis;
            }
            
            if (document.getElementById('includeRiskAssessment').checked) {
                content += riskAssessment;
            }
            
            if (document.getElementById('includeRecommendations').checked) {
                content += recommendations;
            }
            
            if (document.getElementById('includeCompliance').checked) {
                content += `
                    <h2>Compliance Status</h2>
                    <p>Compliance assessment against industry standards:</p>
                    <ul>
                        <li>OWASP Top 10: 65% compliant</li>
                        <li>PCI DSS: 78% compliant</li>
                        <li>ISO 27001: 72% compliant</li>
                        <li>NCA: 82% compliant</li>
                        <li>SAMA: 75% compliant</li>
                    </ul>
                `;
            }
            
            if (document.getElementById('includeAppendix').checked) {
                content += `
                    <h2>Technical Appendix</h2>
                    <h3>Methodology</h3>
                    <p>This assessment was conducted using industry-standard penetration testing methodologies including OWASP Testing Guide and NIST SP 800-115.</p>
                    
                    <h3>Tools Used</h3>
                    <ul>
                        <li>Nmap - Network discovery and port scanning</li>
                        <li>OWASP ZAP - Web application security testing</li>
                        <li>Burp Suite - Web vulnerability assessment</li>
                        <li>Metasploit - Exploitation framework</li>
                    </ul>
                `;
            }
            
            return content;
        }

        // Download report as PDF
        function downloadReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Get report content
            const reportContent = document.getElementById('reportPreview');
            
            // Convert HTML to PDF
            html2canvas(reportContent).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 210;
                const pageHeight = 295;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;
                
                let position = 0;
                
                doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    doc.addPage();
                    doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                const filename = `${document.getElementById('reportTitle').value.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(filename);
            });
        }

        // Update report queue
        function updateReportQueue() {
            const queueContainer = document.getElementById('reportQueue');
            queueContainer.innerHTML = '';
            
            reportQueue.slice(0, 5).forEach(report => {
                const reportElement = document.createElement('div');
                reportElement.className = 'report-item mb-2 p-2';
                reportElement.style.cssText = `
                    background: var(--bg-glass-light);
                    border-radius: var(--radius-sm);
                    border-left: 3px solid var(--accent-cyan);
                `;
                
                reportElement.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="text-primary font-medium">${report.title}</div>
                            <div class="text-secondary text-sm">${report.generated} ‚Ä¢ ${report.size}</div>
                        </div>
                        <div class="flex gap-1">
                            <button class="cyber-btn cyber-btn-secondary" onclick="downloadReportById('${report.id}')" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">
                                üì•
                            </button>
                            <button class="cyber-btn cyber-btn-secondary" onclick="deleteReport('${report.id}')" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                `;
                
                queueContainer.appendChild(reportElement);
            });
        }

        // Create schedule
        function createSchedule() {
            const schedule = {
                id: 'SCH-' + Date.now(),
                template: document.getElementById('scheduleTemplate').value,
                frequency: document.getElementById('scheduleFrequency').value,
                recipients: document.getElementById('scheduleRecipients').value,
                created: new Date().toLocaleDateString(),
                nextRun: getNextRunDate(document.getElementById('scheduleFrequency').value)
            };
            
            activeSchedules.push(schedule);
            updateActiveSchedules();
            
            // Clear form
            document.getElementById('scheduleRecipients').value = '';
        }

        // Get next run date
        function getNextRunDate(frequency) {
            const now = new Date();
            switch (frequency) {
                case 'daily':
                    now.setDate(now.getDate() + 1);
                    break;
                case 'weekly':
                    now.setDate(now.getDate() + 7);
                    break;
                case 'monthly':
                    now.setMonth(now.getMonth() + 1);
                    break;
                case 'quarterly':
                    now.setMonth(now.getMonth() + 3);
                    break;
            }
            return now.toLocaleDateString();
        }

        // Update active schedules
        function updateActiveSchedules() {
            const container = document.getElementById('activeSchedules');
            container.innerHTML = '';
            
            activeSchedules.forEach(schedule => {
                const scheduleElement = document.createElement('div');
                scheduleElement.className = 'schedule-item';
                scheduleElement.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="text-primary font-medium">${schedule.template.charAt(0).toUpperCase() + schedule.template.slice(1)} Report</div>
                            <div class="text-secondary text-sm">${schedule.frequency} ‚Ä¢ Next: ${schedule.nextRun}</div>
                            <div class="text-secondary text-sm">Recipients: ${schedule.recipients}</div>
                        </div>
                        <button class="cyber-btn cyber-btn-danger" onclick="deleteSchedule('${schedule.id}')" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">
                            üóëÔ∏è
                        </button>
                    </div>
                `;
                container.appendChild(scheduleElement);
            });
        }

        // Action functions
        function emailReport() {
            alert('Email report functionality - would open email composer');
        }

        function shareReport() {
            alert('Share report functionality - would generate shareable link');
        }

        function editReport() {
            alert('Edit report functionality - would open report editor');
        }

        function saveTemplate() {
            alert('Save template functionality - would save current configuration');
        }

        function downloadReportById(reportId) {
            alert(`Download report ${reportId}`);
        }

        function deleteReport(reportId) {
            reportQueue = reportQueue.filter(r => r.id !== reportId);
            updateReportQueue();
        }

        function deleteSchedule(scheduleId) {
            activeSchedules = activeSchedules.filter(s => s.id !== scheduleId);
            updateActiveSchedules();
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializeDates();
            updateReportOptions();
            
            // Add some sample reports to queue
            reportQueue = [
                {
                    id: 'RPT-001',
                    title: 'Weekly Security Summary',
                    type: 'executive',
                    format: 'pdf',
                    generated: new Date(Date.now() - 86400000).toLocaleString(),
                    size: '2.3 MB'
                },
                {
                    id: 'RPT-002',
                    title: 'Vulnerability Assessment Report',
                    type: 'vulnerability',
                    format: 'pdf',
                    generated: new Date(Date.now() - 172800000).toLocaleString(),
                    size: '4.7 MB'
                }
            ];
            
            updateReportQueue();
        });
    </script>
</body>
</html>